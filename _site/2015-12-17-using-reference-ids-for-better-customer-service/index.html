<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>My Blog</title>
</head>
<body>
<h1>Using Reference Ids for Better Customer Service</h1>

<img loading="lazy" class="aligncenter size-full wp-image-13908" style="margin-bottom: 20px;" src="http://exceptionless.com/assets/reference-ids-blog-header-image.png" alt="Exceptionless Reference IDs" width="708" height="250" data-id="13908" srcset="https://exceptionless.com/assets/reference-ids-blog-header-image.png 708w, https://exceptionless.com/assets/reference-ids-blog-header-image-300x106.png 300w" sizes="(max-width: 708px) 100vw, 708px" />
<p>This week we want to talk about <strong>reference Ids</strong> and how we use them to <strong>improve customer service</strong> for Exceptionless. And how we think you can do the same for your users.</p>
<h2>What’s a Reference Id?</h2>
<p>A reference id is a unique identifier, generated by the user, that allows you to look up a submitted event at a later time. This is important because <em>event Ids are not created until after the event is processed</em>, so there is no other way to look up an event. We also use Reference Ids to help deduplicate events server side, which is another reason why it’s important that they are unique.</p>
<h2>Using Reference Ids for the Greater Good</h2>
<!--more-->
<p>One of the ways we use Reference Ids is to <strong>support end users</strong>, something that is very important to us. There is nothing more frustrating than being unable to help a user that is experiencing a problem because you don’t know what they are seeing (when there could be thousands of errors in your app).</p>
<p>To combat this issue, we always try to include a reference Id with every error message shown to the user. This allows end users to contact us with a Reference Id and receive help <strong>immediately</strong> for the error they are seeing because we can <strong>easily track down and view it</strong>.</p>
<h2>Reference Id Example</h2>
<p>The Exceptionless clients have built in support to generate and track unique Reference Ids for every error event. Behind the scenes, we register a default Reference Id plugin that sets a Reference Id on submitted error events and stores the Reference Id in an implementation of <a>ILastReferenceIdManager</a>. The Reference Id manager’s goal is just to persist and retrieve the last used Reference Id.</p>
<p>Since this is a default plugin, we can enable this behavior by calling the <code>UseReferenceIds()</code> method on the configuration object to register the default Reference Id on every error event.</p>
<h3>C# Example</h3>
<pre class="brush: csharp; title: ; notranslate" title="">using Exceptionless;
ExceptionlessClient.Default.Configuration.UseReferenceIds();</pre>
<h3>JavaScript Example</h3>
<pre class="brush: jscript; title: ; notranslate" title="">exceptionless.ExceptionlessClient.default.config.useReferenceIds();</pre>
<p>Please note that you can <strong>create your own plugin</strong> to create your very own Reference Id(s).</p>
<p>To <strong>get the the last used Reference Id</strong>, you can call the <code>GetLastReferenceId()</code> helper method on the the <code>ExceptionlessClient</code> instance.</p>
<h4>C#</h4>
<pre class="brush: csharp; title: ; notranslate" title="">using Exceptionless;
// Get the last created Reference Id
ExceptionlessClient.Default.GetLastReferenceId();</pre>
<h4>JavaScript</h4>
<pre class="brush: jscript; title: ; notranslate" title="">// Get the last created Reference Id
exceptionless.ExceptionlessClient.default.getLastReferenceId();
</pre>
<p>You might have noticed how easy it is to get or add Reference Id’s to your events automatically. This makes it a breeze to let your developers track down user-facing issues by displaying the Reference Id to your end users.</p>
<p>We <strong>display Reference Ids</strong> to all of our end users anytime an error occurs in our ASP.NET WebAPI application. We accomplish this by adding a custom <code>&lt;a href=&quot;http://www.asp.net/web-api/overview/error-handling/web-api-global-error-handling&quot; target=&quot;_blank&quot;&gt;IExceptionHandler&lt;/a&gt;</code> and return a new <a href="https://github.com/exceptionless/Exceptionless/blob/master/Source/Api/Utility/Handlers/ExceptionlessReferenceIdExceptionHandler.cs#L35-L51" target="_blank">error response to include the Reference Id</a> as shown below:</p>
<pre class="brush: csharp; title: ; notranslate" title="">public class ExceptionlessReferenceIdExceptionHandler : IExceptionHandler {
	public Task HandleAsync(ExceptionHandlerContext context, CancellationToken cancellationToken) {
		if (context == null)
			throw new ArgumentNullException(nameof(context));

		var exceptionContext = context.ExceptionContext;
		var request = exceptionContext.Request;
		if (request == null)
			throw new ArgumentException($"{typeof(ExceptionContext).Name}.{"Request"} must not be null", nameof(context));

		context.Result = new ResponseMessageResult(CreateErrorResponse(request, exceptionContext.Exception, HttpStatusCode.InternalServerError));
		return TaskHelper.Completed();
	}

	private HttpResponseMessage CreateErrorResponse(HttpRequestMessage request, Exception ex, HttpStatusCode statusCode) {
		HttpConfiguration configuration = request.GetConfiguration();
		HttpError error = new HttpError(ex, request.ShouldIncludeErrorDetail());

		string lastId = ExceptionlessClient.Default.GetLastReferenceId();
		if (!String.IsNullOrEmpty(lastId))
			error.Add("Reference", lastId);

		// CreateErrorResponse should never fail, even if there is no configuration associated with the request
		// In that case, use the default HttpConfiguration to con-neg the response media type
		if (configuration == null) {
			using (HttpConfiguration defaultConfig = new HttpConfiguration()) {
				return request.CreateResponse(statusCode, error, defaultConfig);
			}
		}

		return request.CreateResponse(statusCode, error, configuration);
	}
}</pre>
<p>The next step is to <a href="https://github.com/exceptionless/Exceptionless/blob/master/Source/Api/AppBuilder.cs#L63" target="_blank">replace the existing <code>IExceptionFilter</code></a> with the one above.</p>
<pre class="brush: csharp; title: ; notranslate" title="">Config.Services.Replace(typeof(IExceptionHandler), new ExceptionlessReferenceIdExceptionHandler());</pre>
<p>Finally, when an error occurs in your app, you’ll get a more user friendly error response that contains a Reference Id!</p>
<pre class="brush: csharp; title: ; notranslate" title="">{
  "message": "An error has occurred.",
  “reference”: “411085622e”
}</pre>
<p>We’ve found that this allows consumers of our API to quickly contact us with a reference id and get up and running quickly!</p>
<h2>Looking up Events by Reference Id</h2>
<p>You might be thinking: “Reference Ids are great, but what do I do with them now that I have one.” Well, you can view the event that they reference on our site or via our API. This can be accomplished two different ways:</p>
<ul>
<li>**Hotlinking<br>
** You can link directly to a submitted event by outputting a link in your UI or logs (e.g. https://be.exceptionless.io/event/by-ref/YOUR_REFERENCE_ID)</li>
<li>**Search<br>
** You can search via our api/ui with <code>reference:YOUR_REFERENCE_ID</code></li>
</ul>
<h2>Your Turn!</h2>
<p>We hope this article was helpful, and we’d love to know if you’re using Reference Ids and how they’ve helped you help users, solve internal issues, etc. Post a comment below!</p>

</body>
</html>
